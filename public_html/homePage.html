<!DOCTYPE html>
<html>

	<head lang="en">
		<meta charset="UTF-8">
		<title>Home Page</title>
		<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="/css/reset.css" />
		<link rel="stylesheet" type="text/css" href="/css/common.css" />
		<link rel="stylesheet" type="text/css" href="/css/icon.css" />
		<link rel="stylesheet" type="text/css" href="/css/home.css" />
		<script src="./jquery.js"></script>
		<script src="./js/post.js"></script>
		<script type="text/javascript">
			$(function() {
				islogin(function (result,result2) {
					if(result==1){
						$(".avatar img").attr("src", "./avatar"+ result2.avatar)
						console.log(result2.avatar)

						$(".post").show()
						var role=sessionStorage.getItem("loginRole");
						if(role=="2"){
							$("#admin").show()
							$(".manager").show()
							if($(".managePost").hasClass("on")){
								$(".post-wrap").addClass("del")
							}
						}else if(role=="1"){
							$("#member").show()
						}
					}else{
						$(".avatar img").attr("src","./avatar/duck.jpeg")
						$(".post").hide();
						$("#tourist").show()
					}
				})
				var  url="http://localhost:8888/post/getAllPost?page=";

				//获取帖子总数
				getPostCount("http://localhost:8888/post/getAllPostCount",function (page) {
					var pageSize=parseInt(page)+1;

					for(var i=1;i<pageSize;i++){

						var page=$("<li></li>").html(i);
						$(".pageCount ul").append(page)
					}
				})

				//点击页数获取帖子
				$(".pageCount ul").on("click","li", function (e) {
					var  page=$(this).html();
					getpost(url,page)
				})

				//默认获取第一页帖子
				getpost(url,1);
				
				//管理员管理帖子
				$(".manager").on("click","a", function () {
					if(this.id=="showAllUser"){
						if($(this).hasClass("on")){
							$(this).removeClass("on")
						}else{
							$(this).addClass("on")
						}
					}else if(this.id=="managePost"){
						if($(this).hasClass("on")){
							$(".post-wrap").removeClass("del")
							$(this).removeClass("on")
						}else{
							$(".post-wrap").addClass("del")
							$(this).addClass("on")
						}
					}
				})


				//监听发帖事件
				$("#postSub").on("click", function() {
					var title=$("#postTitle").val()
					var val = $("#postContent").val();
					if(val&&title) {
						//内容不为空
						$.post("http://localhost:8888/post/setPost", $("#form").serialize(), function(result) {
							if(result == "1") {
								//发表成功
								alert("Success")
								$("#form")[0].reset()
								location.reload()

							} else {
								//发表失败
								alert("Faile")
							}
						})
					} else  {
						alert("Content or title cannot be NULL")
					}
				})

			})
		</script>
	</head>

	<body>
		<div class="webblog home">
			<header class="webblog_top ">
				<div class="container">

					<div class="webName">
						ChowChow
					</div>
					<div class="search">
						<input type="text" name="" id="" value="" />
						<a href="" class="icon icon-fangda"></a>
					</div>
					<div class="nav">
						<div class="user" style="display: none;">
							<span>
								<a href="" id="personPage">
									<i class="icon icon-person"></i>
									<span id="username"></span>
								</a>
								<div class="commentPrompt">

									<div class="comment-inner"></div>
									<a class="newCount">21</a>
									<div class="iknow">
										<button href="javascript:;" >Details</button>
										<button href="javascript:;" >Cancel</button>
									</div>

								</div>
								
								<a href="http://localhost:8888/user/logout" class="logout">Quit</a>
							</span>
						</div>
						<div class="login">
							<a href="http://localhost:8888/login.html">Login</a>
							<a href="http://localhost:8888/regist.html">Register</a>
						</div>
						<div class="homepage">
							<a href="http://localhost:8888/homepage.html">
								<i class="icon icon-home"></i> Home Page
							</a>
						</div>
					</div>
			
				</div>
				<div class="shadeBg">
				
			</div>
				<div class="showNewComment">
					<a href="javascript:;" id="closeShow"></a>
					<div class="showNewComment-inner">
						<div class="showNewComment-content comment-list">

						</div>
					</div>
				</div>



			</header>
			<!--中间内容-->
			<div class="webblog_main">
				<div class="container">

					<div class="row">
						<div class="col-md-9">
							<div class="post clearfix">
								<h1>You can post a thread here</h1>
								<form id="form">
									<textarea name="postTitle" id="postTitle" placeholder="Post title"></textarea>
									<textarea name="postContent" id="postContent" placeholder="Post content"></textarea>
									<input type="button" value="Post" id="postSub" />
								</form>
							</div>
							<div class="post-wrap">
								
							</div>
							

						</div>
						<div class="col-md-3">
							<div class="text-box">
								<div class="avatar">
									<img src="" />
								</div>
								<p class="welcome-tips" id="tourist">Welcome</p>
								<!-- <p class="welcome-tips" id="member">欢迎你啊，会员</p> -->
							</div>
						</div>
					</div>

					<div class="pageCount clearfix">
						<ul></ul>
					</div>
				</div>

			</div>
		</div>

		<div class="commentforPrompt">
			<div class="form-group  input-group-lg ">
				<div class="col-md-10">
					<input type="text" name="commentforlast" class="form-control input-lg" id="commentforlast" value="" />
				</div>
				<div class="col-md-2">
					<input type="button" value="Submit" class="btn btn-success btn-lg" id="submitComment" />
					<input type="button" value="Cancel" class="btn btn-default btn-lg" id="cancelComment" />
				</div>
			</div>
		</div>
	</body>
</html>